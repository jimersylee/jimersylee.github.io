<!DOCTYPE html>

<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>设计模式之观察者模式|Jimersy Lee's Blog </title>
    
    <meta name="keywords" content="JAVA,PATTERN,java,Jimersy Lee,jimersylee,java,php,python,js,html,github">
	<meta name="description" content="观察者模式(Observer),让你的对象知悉现况">
    <link rel="stylesheet" type="text/css" href="http://local.v4.blog.com/theme/beach/css/style.css?ver=2.3.2">
    <link rel="stylesheet" type="text/css" href="http://local.v4.blog.com/theme/beach/css/markdown.css?ver=2.3.2">
    <link rel="alternate" type="application/rss+xml" title="Jimersy Lee's Blog" href="http://local.v4.blog.com/feed.xml" />
    
    <!--[if IE]>
	<script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<![endif]-->
	
    <!--[if IE 6]>
	<script src="http://local.v4.blog.com/theme/beach/js/belatedPNG.js"></script>
	<script>
    	DD_belatedPNG.fix('*');
	</script>
	<![endif]-->
	
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?3f9957e676a9733fcd02eb9f0e5f9416";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
	</head>

<body>
    <section id="page">
        <div id="pagewrap">
        		<section id="sidebar">
	    <h2>分类</h2>
    <ul>
            <li>
            <a href="http://local.v4.blog.com/category/linux.html">linux</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/python.html">python</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/js.html">js</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/devops.html">devops</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/spring.html">spring</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/go.html">go</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/thoughts.html">thoughts</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/books.html">books</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/java.html">java</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/category/php.html">php</a>
        </li>
        </ul>
        
        <h2>标签</h2>
    <ul>
            <li>
            <a href="http://local.v4.blog.com/tags/LINUX.html">LINUX</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SHORTCUT-KEY.html">SHORTCUT-KEY</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/CENTOS.html">CENTOS</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/MANJARO.html">MANJARO</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/fusuma.html">fusuma</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/VIM.html">VIM</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SPACEVIM.html">SPACEVIM</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/PYTHON.html">PYTHON</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/MACHINE-LEARNING.html">MACHINE-LEARNING</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SCRAPY.html">SCRAPY</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/CRAWLER.html">CRAWLER</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/JS.html">JS</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/JAVASCRIPT.html">JAVASCRIPT</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/NGINX.html">NGINX</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SSL.html">SSL</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/JENKINS.html">JENKINS</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/HARBOR.html">HARBOR</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/DEVOPS.html">DEVOPS</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/MARIADB.html">MARIADB</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/Spring.html">Spring</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/Cloud.html">Cloud</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/%E7%AE%80%E4%BB%8B.html">简介</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SPRING-CLOUD.html">SPRING-CLOUD</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/GO.html">GO</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/Blog.html">Blog</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/BLOG.html">BLOG</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/DEV.html">DEV</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/RULE.html">RULE</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/ML.html">ML</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/BOOKS.html">BOOKS</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/BACK-END.html">BACK-END</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/JAVA.html">JAVA</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/PATTERN.html">PATTERN</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/JVM.html">JVM</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/PHP.html">PHP</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/SWOOLE.html">SWOOLE</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/tags/STRING.html">STRING</a>
        </li>
        </ul>
        
        <h2>归档</h2>
    <ul>
            <li>
            <a href="http://local.v4.blog.com/archive/202006.html">2020-06</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/202005.html">2020-05</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/202002.html">2020-02</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201809.html">2018-09</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201709.html">2017-09</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201707.html">2017-07</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201704.html">2017-04</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201608.html">2016-08</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201607.html">2016-07</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201605.html">2016-05</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201510.html">2015-10</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201508.html">2015-08</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201507.html">2015-07</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201505.html">2015-05</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201504.html">2015-04</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201503.html">2015-03</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201411.html">2014-11</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201408.html">2014-08</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201407.html">2014-07</a>
        </li>
            <li>
            <a href="http://local.v4.blog.com/archive/201401.html">2014-01</a>
        </li>
        </ul>
    </section>        	<section id="contents">
	<header id="mainheader">
		<h1><a href="http://local.v4.blog.com/"><span>Jimersy Lee's Blog</span></a></h1>
	</header>
	
	<section id="main">
	<article class="post">
    <header>
    	        <h2>设计模式之观察者模式</h2>
		        <p class="postinfo">JAVA,PATTERN,java | <time>2015-04-08</time> | by <i>Jimersy Lee</i></p>
    </header>

    <section class="entry">
        <p>
        		<!--
author: Jimersy Lee
head: 
date: 2015-04-08
title: 设计模式之观察者模式
tags: JAVA,PATTERN
images: 
category: java
status: publish
summary: 观察者模式(Observer),让你的对象知悉现况
-->
<h1>观察者模式(Observer)</h1>
<p>让你的对象知悉现况</p>
<p>使用自定义的Subject(主题)与Observer(观察者模式)</p>
<p>设计原则</p>
<blockquote>
<p>找出程序中会变化的方面,然后将其和固定不变的部分分离</p>
</blockquote>
<p>在观察者模式中,会改变的事主题的状态,以及观察者的数目和类型.用这个模式,你可以改变依赖于主题状态的对象,却不改变主题.这就叫提前规划</p>
<blockquote>
<p>针对接口编程,不针对实现编程</p>
</blockquote>
<p>主题与观察者都使用接口:观察者利用主题的接口向主题注册,二主题利用观察者接口通知观察者.这样可以让两者之前运作正常,同时具有松耦合的优点</p>
<blockquote>
<p>多用组合,少用继承</p>
</blockquote>
<p>观察者模式利用&quot;组合&quot;将许多观察者组合进主题中.对象之前的这种关系不是通过继承产生的,而是在运行时利用组合的方式而产生的.</p>
<h1>自己实现观察者模式</h1>
<h2>我们先定义主题接口</h2>
<pre><code>
/**
 * 主题接口
 */
public interface Subject {
    public void registerObserver(Observer o);
    public void removeObserver(Observer o);
    public void notifyObservers();

}
</code></pre>
<h2>定义观察者接口</h2>
<pre><code>/**
 * 观察者接口
 */
public interface Observer {
    public void update(float temp,float humidity,float pressure);
}
</code></pre>
<h2>显示元素接口</h2>
<pre><code>/**
 * 显示元素接口
 */
public interface DisplayElement {
    public void display();
}
</code></pre>
<h2>编写公告板实现,实现了观察者接口与显示元素接口</h2>
<pre><code>/**
 * 公告板实现
 */
public class CurrentConditionDisplay implements Observer,DisplayElement {
    private float temperature;
    private float humidity;
    private Subject weatherData;

    /**
     * 构造器需要weatherData对象(也就是主题)作为注册之用
     * @param weatherData:天气对象
     */
    public CurrentConditionDisplay(Subject weatherData){
        this.weatherData=weatherData;
        weatherData.registerObserver(this);
    }

    /**
     * display()方法就只是把最近的问的和湿度显示出来
     */
    @Override
    public void display() {
        System.out.println("Current conditions:"+temperature+"F degree and "+humidity+"% humidity");
    }

    /**
     * 当update被调用时,我们把温度和湿度保存起来,然后调用display
     * @param temp
     * @param humidity
     * @param pressure
     */
    @Override
    public void update(float temp, float humidity, float pressure) {
            this.temperature=temp;
            this.humidity=humidity;
            display();
    }
}
</code></pre>
<h2>天气数据实现主题接口</h2>
<pre><code>import java.util.ArrayList;

/**
 * 天气数据类实现了Subject(主题)接口
 */
public class WeatherData implements Subject {
    private ArrayList&lt;Observer&gt; observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData(){
        observers=new ArrayList&lt;&gt;();
    }

    @Override
    public void registerObserver(Observer o) {
        observers.add(o);
    }

    @Override
    public void removeObserver(Observer o) {
        int i=observers.indexOf(o);
        if(i&gt;=0){
            observers.remove(i);
        }
    }

    @Override
    public void notifyObservers() {
        for (Observer observer : observers) {
            observer.update(temperature, humidity, pressure);
        }
    }

    /**
     * 此方法会在气象值变化时被调用
     */
    public void measurementsChanged(){
        notifyObservers();
    }

    public void setMeasurements(float temperature,float humidity,float pressure){
        this.temperature=temperature;
        this.humidity=humidity;
        this.pressure=pressure;
        measurementsChanged();
    }
}
</code></pre>
<h2>来个测试吧</h2>
<pre><code>public class WeatherStation {
    public static void main(String[] args){
        WeatherData weatherData=new WeatherData();

        CurrentConditionDisplay currentConditionDisplay=new CurrentConditionDisplay(weatherData);
        weatherData.setMeasurements(80,65,30.4f);
    }
}

#输出
Current conditions:80.0F degree and 65.0% humidity</code></pre>
<h1>使用java自带的Observer</h1>
<h2>定义显示元素接口</h2>
<pre><code>package Observable;

public interface DisplayElement {
    public void display();
}
</code></pre>
<h2>实现观察者接口和显示元素接口</h2>
<pre><code>package Observable;

import java.util.Observable;
import java.util.Observer;

/**
 * 天气状况布告板
 * Created by jimersylee on 
 */
public class CurrentConditionDisplay implements Observer,DisplayElement {
    Observable observable;
    private float temperature;
    private float humidity;

    public CurrentConditionDisplay(Observable observable){
        this.observable=observable;
        observable.addObserver(this);
    }

    public void update(Observable obs,Object arg){
        if(obs instanceof WeatherData){
            WeatherData weatherData=(WeatherData)obs;
            this.temperature=weatherData.getTemperature();
            this.humidity=weatherData.getHumidity();
            display();
        }
    }

    public void display(){
        System.out.println("Current conditions:"+temperature+"F degrees and "+humidity+"% humidity");
    }

}
</code></pre>
<h2>实现观察者抽象类</h2>
<pre><code>package Observable;

import java.util.Observable;

/**
 * 使用java.util内置的观察者模式实现
 * Created by jimersylee 
 */
public class WeatherData extends Observable {
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData(){

    }

    public void measurementsChanged(){
        setChanged();
        notifyObservers();
    }

    public float getTemperature(){
        return temperature;
    }

    public float getHumidity(){
        return humidity;
    }

    public float getPressure(){
        return pressure;
    }

    public void setMeasurements(float temperature,float humidity,float pressure){
        this.temperature=temperature;
        this.humidity=humidity;
        this.pressure=pressure;
        measurementsChanged();
    }

}
</code></pre>
<h2>写个测试吧</h2>
<pre><code>package Observable;

public class WeatherStation {
    public static void main(String[] args){
        WeatherData weatherData=new WeatherData();

        CurrentConditionDisplay currentConditionDisplay=new CurrentConditionDisplay(weatherData);

        weatherData.setMeasurements(80,30,33.2f);
    }
}

#输出
Current conditions:80.0F degrees and 30.0% humidity
</code></pre>
<h2>项目地址</h2>
<p><a href="https://github.com/jimersylee/DesignPattern">java设计模式实现</a>
如果觉得有点收获,记得在项目上点star哦!</p>
				</p>
    </section>
</article>	<section id="comments">
				<div class="post-content">
			<div id="disqus_thread"></div>
			<script>
var disqus_config = function () {
	this.page.url = location.href;
	this.page.identifier = 'c2e7a63f2c132baea128490b97f78d4d';
};
(function() {
	var d = document, s = d.createElement('script');
	s.src = '//jimersylee.disqus.com/embed.js';
	s.setAttribute('data-timestamp', +new Date());
	(d.head || d.body).appendChild(s);
})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		</div>
			</section>
</section>
    
    <footer id="pagefooter">
    <div class="footerwrap">
        <p class="siteinfo">Copyright &copy 2015 Gtiblog. All Rights Reserved. <a href="http://www.gitblog.cn">Proudly powered by Gitblog</a></p>
    </div>
</footer> 
</section>
        	<div class="clear"></div>
        </div>
    </section>

<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/8.6/styles/magula.min.css">
<script src="//cdn.bootcss.com/highlight.js/8.6/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
</html>
